<!DOCTYPE html>
<html>
<head>
    <title>Create Team</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        /* Zmniejszona wysokość treści w modalu */
        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 12px;
        }

        /* Kompaktowe style pól */
        .compact-form .form-control,
        .compact-form .form-select {
            padding: 4px 8px;
            height: 32px;
            font-size: 0.9rem;
        }

        .compact-form label {
            font-size: 0.82rem;
            margin-bottom: 3px;
        }

        .compact-form .mb-2 {
            margin-bottom: 10px !important;
        }
    </style>
</head>

<body class="p-3 compact-form">

<h4 class="mb-3">Create Team</h4>

<form id="createTeamForm" action="/teams/create/" method="POST">
  {% csrf_token %}


  <!-- <div class="mb-3">
    <label>Team Name</label>
    <input name="Name" type="text" class="form-control" required value="Cesena">
  </div> -->

    <div class="mb-3">
        <label>Team Name</label>
        <select id="nameSelect" name="Name" class="form-select">
            <option value="Cesena">Cesena</option>
            <option value="Reggiana">Reggiana</option>
            <option value="Udinese">Udinese</option>
            <option value="Gornik">Gornik</option>
            <option value="Siarka">Siarka</option>
            <option value="Perugia">Perugia</option>
            <option value="Stal">Stal</option>
            <option value="Betis">Betis</option>
            <option value="Juventus">Juventus</option>
            <option value="ACMilan">ACMilan</option>
        </select>
    </div>


  <div class="mb-3">
    <label>Description</label>
    <textarea name="Description" class="form-control"></textarea>
  </div>

  <!-- <div class="mb-3">
    <label>Nationality Name</label>
    <input name="NationalityName" type="text" class="form-control" value="Italy">
  </div> -->

    <div class="mb-3">
        <label>Nationality Name</label>
        <select id="NationalityNameSelect" name="NationalityName" class="form-select">
            <option value="Italy">Italy</option>
            <option value="Polish">Polish</option>
            <option value="Spain">Spain</option>
            <option value="Germany">Germany</option>
            <option value="England">England</option>
        </select>
    </div>


  <!-- <div class="mb-3">
    <label>Season</label>
    <input name="Season" type="text" class="form-control" value="2025">
  </div> -->

<div class="mb-3">
  <label>Season</label>
  <input
    type="number"
    name="Season"
    class="form-control"
    value="2025"
    min="1000"
    max="9999"
    step="1"
    required>
</div>

<!-- <form onsubmit="return validateSeason()">
  <div class="mb-3">
    <label>Season</label>
    <input
      value="2025"
      type="number"
      name="Season"
      class="form-control"
      min="1000"
      max="9999"
      required>
  </div>
</form> -->


  <div class="mb-3">
    <label>Top Scorer</label>
    <input name="TopScorer" type="text" class="form-control" value="Gustavo Lopez">
  </div>
  <div class="mb-3">
    <label>Picture URL</label>
    <input name="Picture" type="text" class="form-control" placeholder="https://example.com/image.png">

  <!-- </div>
    <div class="mb-3">
    <label>Trophy Win</label>
    <input name="TrophyWin" type="text" class="form-control" value="test">
  </div> -->

    <div class="mb-3">
        <label>TrophyWin</label>
        <select id="trophyWinSelect" name="TrophyWin" class="form-select">            
            <option value="ItalyCup">ItalyCup</option>
            <option value="ChampionsCup">ChampionsCup</option>
            <option value="UefaCup">UefaCup</option>
            <option value="ChampionLeague">ChampionLeague</option>
            <option value="CwcCup">CwcCup</option>
            <option value="PolishCup">PolishCup</option>            
            <option value="SpanishCup">SpanishCup</option>            
            <option value="GermanyCup">GermanyCup</option>            
            <option value="EnglandCup">EnglandCup</option>            
            <option value="Loser">Loser</option>            
        </select>
    </div>

  <div class="mb-3">
    <label>Final Result</label>
    <input name="FinalResult" type="text" class="form-control" value="Cesena:ACMilan 5:0">
  </div>

  <button type="submit" class="btn btn-primary">Create Team</button>
</form>

<!-- ========================================================== -->
<!-- TOASTS -->
<!-- ========================================================== -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1055;">
    <div id="teamCreatedToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">✅ Team created successfully!</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>

    <div id="teamErrorToast" class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="teamErrorMessage">❌ Error creating team!</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>



    const input = document.querySelector('input[name="Season"]');

    input.addEventListener('input', () => {
      input.value = input.value.replace(/\D/g, '').slice(0, 4);
    });


// function validateSeason() {
//   const season = document.querySelector('input[name="Season"]').value.trim();
//   console.log('Season:', season, 'Length:', season.length);

//   if (season.length !== 4) {
//     alert('Season must be exactly 4 digits');
//     return false;
//   }
//   return true;
// }


    
document.addEventListener('DOMContentLoaded', () => {
    const createTeamForm = document.getElementById('createTeamForm');
    const successToast = new bootstrap.Toast(document.getElementById('teamCreatedToast'));
    const errorToast = new bootstrap.Toast(document.getElementById('teamErrorToast'));
    const errorMessageEl = document.getElementById('teamErrorMessage');

    if (!createTeamForm) return;

    createTeamForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Jeśli używasz plików, nie konwertuj FormData na JSON, wyślij bezpośrednio
        const formData = new FormData(createTeamForm);

        try {
            const response = await fetch('/teams/create/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                    // NIE ustawiaj Content-Type, fetch zrobi to automatycznie przy FormData
                },
                body: formData
            });

            const result = await response.json();

            if (result.success) {
                successToast.show();
                createTeamForm.reset();
                setTimeout(() => location.reload(), 1300);
            } else {
                const msg = result.errors ? Object.values(result.errors).map(e => typeof e === 'string' ? e : JSON.stringify(e)).join('\n') : '❌ Error creating team';
                errorMessageEl.textContent = msg;
                errorToast.show();
            }
        } catch (err) {
            console.error(err);
            errorMessageEl.textContent = '❌ Something went wrong!';
            errorToast.show();
        }
    });

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>

</body>
</html>
